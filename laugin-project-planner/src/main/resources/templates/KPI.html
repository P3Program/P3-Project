<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Laugin KPI</title>
    <link rel="stylesheet" th:href="@{/styles/kpi.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar">
    <h1 class="logo">LAUGIN</h1>
    <ul>
        <li><a th:href="@{/}">Dashboard</a></li>
        <li><a href="">Team</a></li>
        <li><a href="">Data</a></li>
        <li><a href="">KPI</a></li>
    </ul>
</nav>

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Key Performance Indicators</h1>
        <p>Real-time task status monitoring</p>
    </div>

    <div class="kpi-section">
        <div class="task-display">
            <div class="red">
                <span class="kpi-label">Critical</span>
                <span class="kpi-value" th:text="${redCount}">0</span>
                <span class="kpi-description">High Priority</span>
            </div>

            <div class="yellow">
                <span class="kpi-label">Important</span>
                <span class="kpi-value" th:text="${yellowCount}">0</span>
                <span class="kpi-description">Medium Priority</span>
            </div>

            <div class="green">
                <span class="kpi-label">Normal</span>
                <span class="kpi-value" th:text="${greenCount}">0</span>
                <span class="kpi-description">Low Priority</span>
            </div>
        </div>
    </div>

    <div class="stats-summary">
        <h3>Total Tasks</h3>
        <div class="total-tasks" id="totalTasks">0</div>
    </div>
</div>

<div class="container-column" style="width: 80%; margin: 40px auto;">
    <div class="column-header">Total Estimated Hours by Priority</div>
    <canvas id="hoursChart" width="400" height="200"></canvas>
</div>

<script>
    fetch('/api/kpi/hours-by-priority')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('hoursChart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Total Estimated Hours',
                        data: Object.values(data),
                        backgroundColor: ['#dc3545', '#ffc107', '#28a745'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Estimate hours distributed based on priority'
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Hours' } },
                        x: { title: { display: true, text: 'Priority' } }
                    }
                }
            });
        });
</script>
<script th:src="@{/scripts/kpi.js}"></script>
</body>
</html>